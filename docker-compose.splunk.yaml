version: '3.8'

services:
    splunk:
        container_name: buffalogs_splunk
        image: splunk/splunk:latest
        hostname: splunk
        restart: unless-stopped
        environment:
            - SPLUNK_START_ARGS=--accept-license
            - SPLUNK_ENABLE_LISTEN=9997
            - SPLUNK_HEC_ENABLE=1
            - SPLUNK_PASSWORD=StrongPassword123  # Use a strong password
        ports:
            - "8000:8000"  # Splunk Web UI
            - "8088:8088"  # HTTP Event Collector (HEC)
            - "9997:9997"  # Receiving events from forwarders
        volumes:
            - splunk_data:/opt/splunk/var
            - ./splunk_config:/opt/splunk/etc/system/local  # Custom Splunk configs
        networks:
            - splunk-net
        healthcheck:
            test: ["CMD", "curl", "-f", "http://localhost:8000"]
            interval: 30s
            timeout: 10s
            retries: 5
        deploy:
            resources:
                limits:
                    memory: 2G
                    cpus: "1.5"

volumes:
    splunk_data:
        driver: local

networks:
    splunk-net:
        driver: bridge
